
# python

Import('*')

import sys, distutils.sysconfig

try:
	pyver		= sys.version[:3]
	makefile	= distutils.sysconfig.parse_makefile(distutils.sysconfig.get_makefile_filename())
	libdir		= distutils.sysconfig.get_python_lib(1)
	incdir		= distutils.sysconfig.get_python_inc(1)
	
	for var, val in makefile.items():
		if var in ['LOCALMODLIBS', 'BASEMODLIBS', 'OTHER_LIBS', 'OTHER_LIBC', 'OTHER_LIBM']:
			val = distutils.sysconfig.expand_makefile_vars(val, makefile)
			for arg in val.split():
				flags.append(arg)

	libs.append('python%s' % pyver)
	flags.append('-L%s' % libdir) # XXX: do we need it?
	flags.append('-I%s' % incdir)
	out = True
except:
	warnings.append("Unable to read Python's Makefile")
	out = False

if out and not env['SKIPCHECKS']:
	old	= SetFlags(env, flags)
	out = conf.CheckLibWithHeader(libs[0], [], 'C', 'Py_Initialize();', 0)
	RestoreFlags(env, old)

Return('out')

# vim:ts=4:sts=4:sw=4:syntax=python
